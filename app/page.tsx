"use client"

import type React from "react"

import { useState, useRef, useEffect } from "react"
import { HeroSection } from "@/components/portfolio/hero-section"
import { SearchBar } from "@/components/portfolio/search-bar"
import { SkillsGraph } from "@/components/portfolio/skills-graph"
import { WorkExperience } from "@/components/portfolio/work-experience"
import { Education } from "@/components/portfolio/education"
import { Academia } from "@/components/portfolio/academic-research"
import { Extracurriculars } from "@/components/portfolio/extracurriculars"
import { PublicService } from "@/components/portfolio/public-service"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { GraphCard } from "@/components/ui/card"

export default function Portfolio() {
  const [searchQuery, setSearchQuery] = useState("")
  const [selectedSkill, setSelectedSkill] = useState<string | null>(null)
  const [isGraphExpanded, setIsGraphExpanded] = useState(false)
  const experienceRef = useRef<HTMLDivElement>(null)
  const educationRef = useRef<HTMLDivElement>(null)
  const researchRef = useRef<HTMLDivElement>(null)
  const extracurricularsRef = useRef<HTMLDivElement>(null)
  const publicServiceRef = useRef<HTMLDivElement>(null)
  const technicalRef = useRef<HTMLDivElement>(null)

  const [tabsWithMatches, setTabsWithMatches] = useState<Set<string>>(new Set())
  const [hasAnyMatches, setHasAnyMatches] = useState(false)

  const handleSearchEnter = () => {
    if (!searchQuery.trim()) return

    const query = searchQuery.toLowerCase()

    const sections = [
      {
        ref: experienceRef,
        keywords: [
          "experience",
          "work",
          "job",
          "career",
          "engineer",
          "developer",
          "ml",
          "ai",
          "threat",
          "intelligence",
          "technical",
          "skills",
          "tools",
          "technology",
          "programming",
          "framework",
          "nagra",
          "netstar",
          "consulting",
          "architect",
          "python",
          "aws",
          "langchain",
          "kql",
          "docker",
          "kubernetes",
        ],
      },
      {
        ref: educationRef,
        keywords: [
          "education",
          "degree",
          "university",
          "college",
          "certificate",
          "school",
          "bellevue",
          "arizona",
          "state",
          "masters",
          "associates",
          "full",
          "stack",
          "web",
          "development",
          "perplexity",
          "ai", // Added "ai" keyword to match AI-related content in education section
          "campus",
          "partner",
          "cyber",
          "saguaro",
          "creative",
          "lab",
          "instructor",
          "research",
          "assistant",
          "comptia",
          "security",
          "eagle",
          "scout",
        ],
      },
      {
        ref: researchRef,
        keywords: [
          "research",
          "academic",
          "academia",
          "paper",
          "publication",
          "conference",
          "pending",
          "threat",
          "detection",
          "ai",
          "machine",
          "learning",
          "semantic",
          "technologies",
          "cybersecurity",
          "iscap",
          "json",
          "ld",
          "distributed",
          "analytics",
        ],
      },
      {
        ref: extracurricularsRef,
        keywords: [
          "extracurricular",
          "volunteer",
          "leadership",
          "community",
          "creative",
          "tutoring",
          "mentoring",
          "webaphors",
          "youtube",
          "discord",
          "math",
          "calculus",
          "statistics",
          "cybersecurity",
          "bootcamp",
        ],
      },
      {
        ref: publicServiceRef,
        keywords: [
          "public",
          "service",
          "commissioner",
          "government",
          "civic",
          "census",
          "bureau",
          "enumerator",
          "youth",
          "group",
          "community",
          "leader",
          "scout",
          "cub",
          "data",
          "collection",
          "eastmark",
          "mesa",
          "sahuarita",
          "planning",
          "zoning",
        ],
      },
    ]

    let bestMatch = sections[0]
    let maxMatches = 0

    sections.forEach((section) => {
      const matches = section.keywords.filter((keyword) => query.includes(keyword)).length
      if (matches > maxMatches) {
        maxMatches = matches
        bestMatch = section
      }
    })

    bestMatch.ref.current?.scrollIntoView({ behavior: "smooth", block: "start" })
  }

  useEffect(() => {
    if (!searchQuery.trim()) {
      setTabsWithMatches(new Set())
      setHasAnyMatches(false)
      return
    }

    const query = searchQuery.toLowerCase()
    const matchingTabs = new Set<string>()

    // Check Work Experience
    const workKeywords = [
      "experience",
      "work",
      "job",
      "career",
      "engineer",
      "developer",
      "ml",
      "ai",
      "threat",
      "intelligence",
      "technical",
      "skills",
      "tools",
      "technology",
      "programming",
      "framework",
      "nagra",
      "netstar",
      "consulting",
      "architect",
      "python",
      "aws",
      "langchain",
      "kql",
      "docker",
      "kubernetes",
    ]
    if (workKeywords.some((keyword) => keyword.includes(query) || query.includes(keyword))) {
      matchingTabs.add("experience")
    }

    // Check Education - include actual content terms
    const educationKeywords = [
      "education",
      "degree",
      "university",
      "college",
      "certificate",
      "school",
      "bellevue",
      "arizona",
      "state",
      "masters",
      "associates",
      "full",
      "stack",
      "web",
      "development",
      "perplexity",
      "ai", // Added "ai" keyword to match AI-related content in education section
      "campus",
      "partner",
      "cyber",
      "saguaro",
      "creative",
      "lab",
      "instructor",
      "research",
      "assistant",
      "comptia",
      "security",
      "eagle",
      "scout",
    ]
    if (educationKeywords.some((keyword) => keyword.includes(query) || query.includes(keyword))) {
      matchingTabs.add("education")
    }

    // Check Academia
    const academiaKeywords = [
      "research",
      "academic",
      "academia",
      "paper",
      "publication",
      "conference",
      "pending",
      "threat",
      "detection",
      "ai",
      "machine",
      "learning",
      "semantic",
      "technologies",
      "cybersecurity",
      "iscap",
      "json",
      "ld",
      "distributed",
      "analytics",
    ]
    if (academiaKeywords.some((keyword) => keyword.includes(query) || query.includes(keyword))) {
      matchingTabs.add("research")
    }

    // Check Extracurriculars
    const extracurricularKeywords = [
      "extracurricular",
      "volunteer",
      "leadership",
      "community",
      "creative",
      "tutoring",
      "mentoring",
      "webaphors",
      "youtube",
      "discord",
      "math",
      "calculus",
      "statistics",
      "cybersecurity",
      "bootcamp",
    ]
    if (extracurricularKeywords.some((keyword) => keyword.includes(query) || query.includes(keyword))) {
      matchingTabs.add("extracurriculars")
    }

    // Check Public Service
    const publicServiceKeywords = [
      "public",
      "service",
      "commissioner",
      "government",
      "civic",
      "census",
      "bureau",
      "enumerator",
      "youth",
      "group",
      "community",
      "leader",
      "scout",
      "cub",
      "data",
      "collection",
      "eastmark",
      "mesa",
      "sahuarita",
      "planning",
      "zoning",
    ]
    if (publicServiceKeywords.some((keyword) => keyword.includes(query) || query.includes(keyword))) {
      matchingTabs.add("public-service")
    }

    setTabsWithMatches(matchingTabs)
    setHasAnyMatches(matchingTabs.size > 0)
  }, [searchQuery])

  return (
    <div className="min-h-screen relative bg-gradient-to-b from-slate-900 via-slate-800 via-slate-600 via-slate-400 to-slate-100">
      <div className="absolute inset-0 overflow-hidden pointer-events-none">
        <svg className="absolute top-32 left-16 w-48 h-48 opacity-20" viewBox="0 0 100 100">
          <defs>
            <linearGradient id="nodeGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stopColor="#8b5cf6" />
              <stop offset="100%" stopColor="#3b82f6" />
            </linearGradient>
            <filter id="glow">
              <feGaussianBlur stdDeviation="2" result="coloredBlur" />
              <feMerge>
                <feMergeNode in="coloredBlur" />
                <feMergeNode in="SourceGraphic" />
              </feMerge>
            </filter>
          </defs>
          <circle cx="20" cy="30" r="3" fill="url(#nodeGrad1)" className="animate-pulse" filter="url(#glow)" />
          <circle
            cx="60"
            cy="20"
            r="2.5"
            fill="url(#nodeGrad1)"
            className="animate-pulse"
            style={{ animationDelay: "0.5s" }}
            filter="url(#glow)"
          />
          <circle
            cx="80"
            cy="60"
            r="4"
            fill="url(#nodeGrad1)"
            className="animate-pulse"
            style={{ animationDelay: "1s" }}
            filter="url(#glow)"
          />
          <circle
            cx="40"
            cy="70"
            r="2"
            fill="url(#nodeGrad1)"
            className="animate-pulse"
            style={{ animationDelay: "1.5s" }}
            filter="url(#glow)"
          />
          <line x1="20" y1="30" x2="60" y2="20" stroke="url(#nodeGrad1)" strokeWidth="1" opacity="0.6" />
          <line x1="60" y1="20" x2="80" y2="60" stroke="url(#nodeGrad1)" strokeWidth="1" opacity="0.6" />
          <line x1="80" y1="60" x2="40" y2="70" stroke="url(#nodeGrad1)" strokeWidth="1" opacity="0.6" />
          <line x1="40" y1="70" x2="20" y2="30" stroke="#334155" strokeWidth="0.8" opacity="0.4" />
        </svg>

        <svg className="absolute top-48 right-24 w-40 h-40 opacity-25" viewBox="0 0 100 100">
          <circle cx="30" cy="40" r="2.5" fill="#8b5cf6" className="animate-ping" />
          <circle cx="70" cy="30" r="3" fill="#3b82f6" className="animate-ping" style={{ animationDelay: "1.5s" }} />
          <circle cx="50" cy="70" r="2" fill="#8b5cf6" className="animate-ping" style={{ animationDelay: "0.8s" }} />
          <line x1="30" y1="40" x2="70" y2="30" stroke="#8b5cf6" strokeWidth="1" opacity="0.5" />
          <line x1="70" y1="30" x2="50" y2="70" stroke="#3b82f6" strokeWidth="1" opacity="0.5" />
        </svg>

        <svg className="absolute top-1/2 left-8 w-56 h-56 opacity-15" viewBox="0 0 100 100">
          <circle cx="25" cy="25" r="2" fill="#8b5cf6" className="animate-pulse" />
          <circle cx="75" cy="35" r="3" fill="#3b82f6" className="animate-pulse" style={{ animationDelay: "0.8s" }} />
          <circle cx="50" cy="70" r="3.5" fill="#8b5cf6" className="animate-pulse" style={{ animationDelay: "1.2s" }} />
          <circle cx="20" cy="60" r="2.5" fill="#3b82f6" className="animate-pulse" style={{ animationDelay: "2s" }} />
          <circle cx="80" cy="75" r="2" fill="#8b5cf6" className="animate-pulse" style={{ animationDelay: "0.3s" }} />
          <line x1="25" y1="25" x2="75" y2="35" stroke="#8b5cf6" strokeWidth="0.8" opacity="0.4" />
          <line x1="75" y1="35" x2="50" y2="70" stroke="#3b82f6" strokeWidth="0.8" opacity="0.4" />
          <line x1="50" y1="70" x2="20" y2="60" stroke="#8b5cf6" strokeWidth="0.8" opacity="0.4" />
          <line x1="20" y1="60" x2="80" y2="75" stroke="#3b82f6" strokeWidth="0.8" opacity="0.4" />
          <line x1="80" y1="75" x2="75" y2="35" stroke="#8b5cf6" strokeWidth="0.6" opacity="0.3" />
        </svg>

        <svg className="absolute top-2/3 right-16 w-44 h-44 opacity-20" viewBox="0 0 100 100">
          <circle cx="40" cy="20" r="2.5" fill="#3b82f6" className="animate-ping" style={{ animationDelay: "2s" }} />
          <circle cx="20" cy="60" r="2" fill="#8b5cf6" className="animate-ping" style={{ animationDelay: "0.3s" }} />
          <circle cx="80" cy="80" r="3" fill="#3b82f6" className="animate-ping" style={{ animationDelay: "1.8s" }} />
          <circle cx="70" cy="40" r="2.5" fill="#8b5cf6" className="animate-pulse" style={{ animationDelay: "1s" }} />
          <line x1="40" y1="20" x2="20" y2="60" stroke="#8b5cf6" strokeWidth="1" opacity="0.5" />
          <line x1="20" y1="60" x2="80" y2="80" stroke="#3b82f6" strokeWidth="1" opacity="0.5" />
          <line x1="80" y1="80" x2="70" y2="40" stroke="#8b5cf6" strokeWidth="1" opacity="0.5" />
          <line x1="70" y1="40" x2="40" y2="20" stroke="#3b82f6" strokeWidth="1" opacity="0.5" />
        </svg>

        <svg className="absolute bottom-32 left-1/4 w-52 h-52 opacity-18" viewBox="0 0 100 100">
          <circle cx="30" cy="30" r="2.5" fill="#8b5cf6" className="animate-pulse" style={{ animationDelay: "0.7s" }} />
          <circle cx="70" cy="50" r="2" fill="#3b82f6" className="animate-pulse" style={{ animationDelay: "1.4s" }} />
          <circle cx="50" cy="80" r="3" fill="#8b5cf6" className="animate-pulse" style={{ animationDelay: "0.2s" }} />
          <circle cx="15" cy="65" r="2" fill="#3b82f6" className="animate-pulse" style={{ animationDelay: "1.8s" }} />
          <circle cx="85" cy="25" r="2.5" fill="#8b5cf6" className="animate-pulse" style={{ animationDelay: "0.9s" }} />
          <line x1="30" y1="30" x2="70" y2="50" stroke="#8b5cf6" strokeWidth="0.8" opacity="0.6" />
          <line x1="70" y1="50" x2="50" y2="80" stroke="#3b82f6" strokeWidth="0.8" opacity="0.6" />
          <line x1="50" y1="80" x2="15" y2="65" stroke="#8b5cf6" strokeWidth="0.8" opacity="0.6" />
          <line x1="15" y1="65" x2="30" y2="30" stroke="#3b82f6" strokeWidth="0.8" opacity="0.6" />
          <line x1="85" y1="25" x2="70" y2="50" stroke="#8b5cf6" strokeWidth="0.6" opacity="0.4" />
        </svg>

        <svg className="absolute bottom-16 right-12 w-36 h-36 opacity-22" viewBox="0 0 100 100">
          <circle cx="25" cy="40" r="3" fill="#3b82f6" className="animate-pulse" style={{ animationDelay: "1.3s" }} />
          <circle cx="75" cy="30" r="2.5" fill="#8b5cf6" className="animate-pulse" style={{ animationDelay: "0.6s" }} />
          <circle cx="60" cy="75" r="2" fill="#8b5cf6" className="animate-pulse" style={{ animationDelay: "2.1s" }} />
          <line x1="25" y1="40" x2="75" y2="30" stroke="#8b5cf6" strokeWidth="1" opacity="0.5" />
          <line x1="75" y1="30" x2="60" y2="75" stroke="#3b82f6" strokeWidth="1" opacity="0.5" />
          <line x1="60" y1="75" x2="25" y2="40" stroke="#8b5cf6" strokeWidth="0.8" opacity="0.4" />
        </svg>
      </div>

      <HeroSection />

      <main className="container mx-auto px-4 pt-4 pb-8 space-y-8 relative z-10">
        <div className="space-y-4">
          <div className="flex flex-col items-center relative">
            <div
              onClick={() => setIsGraphExpanded(!isGraphExpanded)}
              className="cursor-pointer hover:opacity-80 transition-all duration-300 flex flex-col items-center"
            >
              <h3 className="text-xl font-semibold relative">
                <span className="relative inline-block">
                  {"Graph Visualization".split("").map((letter, index) => (
                    <span
                      key={index}
                      className="inline-block animate-wave text-transparent bg-gradient-to-r from-slate-400 via-blue-500 to-slate-600 bg-clip-text animate-color-wave"
                      style={
                        {
                          animationDelay: `${index * 0.1}s`,
                          "--wave-delay": `${index * 0.15}s`,
                        } as React.CSSProperties
                      }
                    >
                      {letter === " " ? "\u00A0" : letter}
                    </span>
                  ))}
                </span>
              </h3>

              <svg width="60" height="12" viewBox="0 0 60 12" className="drop-shadow-sm mt-1">
                <defs>
                  <linearGradient id="smallArrowGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stopColor="#94a3b8" />
                    <stop offset="100%" stopColor="#cbd5e1" />
                  </linearGradient>
                </defs>
                <path
                  d={
                    isGraphExpanded
                      ? "M 10 8 L 30 2 L 50 8 L 45 8 L 30 4 L 15 8 Z"
                      : "M 10 4 L 30 10 L 50 4 L 45 4 L 30 8 L 15 4 Z"
                  }
                  fill="url(#smallArrowGrad)"
                  stroke="#e2e8f0"
                  strokeWidth="0.5"
                  className="transition-all duration-300"
                />
              </svg>
            </div>

            <div className="absolute left-0 right-0 top-0 h-px overflow-visible pointer-events-none">
              <svg className="w-full h-8" viewBox="0 0 400 32" preserveAspectRatio="none">
                <defs>
                  <linearGradient id="leftGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stopColor="#8b5cf6" />
                    <stop offset="100%" stopColor="transparent" />
                  </linearGradient>
                  <linearGradient id="rightGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stopColor="transparent" />
                    <stop offset="100%" stopColor="#3b82f6" />
                  </linearGradient>
                </defs>

                <circle r="2.5" fill="#8b5cf6" opacity="0.8">
                  <animateMotion dur="4s" repeatCount="indefinite">
                    <mpath href="#leftPath" />
                  </animateMotion>
                </circle>
                <circle r="2" fill="#8b5cf6" opacity="0.6">
                  <animateMotion dur="4s" repeatCount="indefinite" begin="2s">
                    <mpath href="#leftPath" />
                  </animateMotion>
                </circle>

                <circle r="2.5" fill="#3b82f6" opacity="0.8">
                  <animateMotion dur="4s" repeatCount="indefinite">
                    <mpath href="#rightPath" />
                  </animateMotion>
                </circle>
                <circle r="2" fill="#3b82f6" opacity="0.6">
                  <animateMotion dur="4s" repeatCount="indefinite" begin="2s">
                    <mpath href="#rightPath" />
                  </animateMotion>
                </circle>

                <path id="leftPath" d="M 140 16 L 50 16" fill="none" opacity="0" />
                <path id="rightPath" d="M 260 16 L 350 16" fill="none" opacity="0" />

                <line x1="50" y1="16" x2="140" y2="16" stroke="url(#leftGrad)" strokeWidth="1" opacity="0.4" />
                <line x1="260" y1="16" x2="350" y2="16" stroke="url(#rightGrad)" strokeWidth="1" opacity="0.4" />
              </svg>
            </div>

            {isGraphExpanded && (
              <GraphCard className="p-6 h-[500px]">
                <SkillsGraph onSkillSelect={setSelectedSkill} selectedSkill={selectedSkill} />
              </GraphCard>
            )}
          </div>

          <Tabs defaultValue="experience" className="w-full">
            <TabsList className="grid w-full grid-cols-5">
              <TabsTrigger
                value="experience"
                className={`text-white font-semibold data-[state=active]:text-foreground transition-all duration-300 ${
                  tabsWithMatches.has("experience")
                    ? "ring-2 ring-purple-400 shadow-lg shadow-purple-200 bg-purple-500/20"
                    : ""
                }`}
              >
                Work Experience
              </TabsTrigger>
              <TabsTrigger
                value="research"
                className={`text-white font-semibold data-[state=active]:text-foreground transition-all duration-300 ${
                  tabsWithMatches.has("research")
                    ? "ring-2 ring-purple-400 shadow-lg shadow-purple-200 bg-purple-500/20"
                    : ""
                }`}
              >
                Academia
              </TabsTrigger>
              <TabsTrigger
                value="public-service"
                className={`text-white font-semibold data-[state=active]:text-foreground transition-all duration-300 ${
                  tabsWithMatches.has("public-service")
                    ? "ring-2 ring-purple-400 shadow-lg shadow-purple-200 bg-purple-500/20"
                    : ""
                }`}
              >
                Public Service
              </TabsTrigger>
              <TabsTrigger
                value="extracurriculars"
                className={`text-white font-semibold data-[state=active]:text-foreground transition-all duration-300 ${
                  tabsWithMatches.has("extracurriculars")
                    ? "ring-2 ring-purple-400 shadow-lg shadow-purple-200 bg-purple-500/20"
                    : ""
                }`}
              >
                Extracurriculars
              </TabsTrigger>
              <TabsTrigger
                value="education"
                className={`text-white font-semibold data-[state=active]:text-foreground transition-all duration-300 ${
                  tabsWithMatches.has("education")
                    ? "ring-2 ring-purple-400 shadow-lg shadow-purple-200 bg-purple-500/20"
                    : ""
                }`}
              >
                Education
              </TabsTrigger>
            </TabsList>

            <div className="mt-6 space-y-6">
              <SearchBar searchQuery={searchQuery} onSearchChange={setSearchQuery} onSearchEnter={handleSearchEnter} />
            </div>

            <TabsContent value="experience" className="mt-6" ref={experienceRef}>
              <WorkExperience searchQuery={searchQuery} selectedSkill={selectedSkill} hasAnyMatches={hasAnyMatches} />
            </TabsContent>

            <TabsContent value="research" className="mt-6" ref={researchRef}>
              <Academia searchQuery={searchQuery} selectedSkill={selectedSkill} hasAnyMatches={hasAnyMatches} />
            </TabsContent>

            <TabsContent value="public-service" className="mt-6" ref={publicServiceRef}>
              <PublicService searchQuery={searchQuery} selectedSkill={selectedSkill} hasAnyMatches={hasAnyMatches} />
            </TabsContent>

            <TabsContent value="extracurriculars" className="mt-6" ref={extracurricularsRef}>
              <Extracurriculars searchQuery={searchQuery} selectedSkill={selectedSkill} hasAnyMatches={hasAnyMatches} />
            </TabsContent>

            <TabsContent value="education" className="mt-6" ref={educationRef}>
              <Education searchQuery={searchQuery} selectedSkill={selectedSkill} hasAnyMatches={hasAnyMatches} />
            </TabsContent>
          </Tabs>
        </div>
      </main>
    </div>
  )
}
